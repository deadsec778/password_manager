{% extends "layout.html" %}
{% block content %}

<h3 class="mb-4"><i class="fa-solid fa-trash-can me-1" style="color: #ff1900;"></i> <span style="color: #ff1900;">Trash Bin</span></h3>

<!-- Tabs for Passwords and Vaults (Admin only) -->
<ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="passwords-tab" data-bs-toggle="tab" data-bs-target="#passwords-content"
            type="button" role="tab">
            <i class="fa-solid fa-key me-1"></i> Deleted Passwords
        </button>
    </li>
    {% if role == 'admin' %}
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="vaults-tab" data-bs-toggle="tab" data-bs-target="#vaults-content" type="button"
            role="tab">
            <i class="fa-solid fa-folder me-1"></i> Deleted Vaults
        </button>
    </li>
    {% endif %}
</ul>

<!-- Tab Content -->
<div class="tab-content">
    <!-- Passwords Tab -->
    <div class="tab-pane fade show active" id="passwords-content" role="tabpanel">
        <table class="table table-striped table-bordered shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Service</th>
                    <th>Owner</th>
                    <th>Username</th>
                    <th>Password</th>
                    <th>Deleted At</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                {% for it in items %}
                <tr>
                    <td>{{ it.service if it.service else '-' }}</td>
                    <td>{{ it.owner }}</td>
                    <td>{{ it.username if it.username else '-' }}</td>
                    <td style="width:260px;">
                        <!-- masked display -->
                        <span id="mask_{{ it.id }}">••••••••••</span>

                        <!-- real password (hidden by default) -->
                        <code id="real_{{ it.id }}" style="display:none;">{{ it.password }}</code>

                        <!-- eye button -->
                        <button class="btn btn-sm btn-outline-secondary ms-2"
                                onclick="togglePasswordRow('{{ it.id }}'); return false;">
                            <i class="fa-regular fa-eye"></i>
                        </button>
                    </td>
                    <td>{{ it.updated_at }}</td>

                    <td>
                        <form method="POST" action="{{ url_for('restore_password_route', password_id=it.id) }}"
                            style="display:inline;">
                            <button class="btn btn-sm btn-outline-primary">
                                Restore
                            </button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center">No deleted passwords.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Vaults Tab (Admin Only) -->
    {% if role == 'admin' %}
    <div class="tab-pane fade" id="vaults-content" role="tabpanel">
        <p class="text-muted mb-3">
            <a href="{{ url_for('trash_vaults') }}" class="btn btn-sm btn-outline-info">
                View Deleted Vaults
            </a>
        </p>
    </div>
    {% endif %}
</div>

{% endblock %}